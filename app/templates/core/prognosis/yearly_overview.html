{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}
{% set active_page = "yearly_overview" %}

{% block styles %}
{{super()}}
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
<link rel="stylesheet" href="{{url_for('static', filename='styles.css')}}">
{% endblock %}

{% block scripts %}
{{super()}}
<script src="{{ url_for('static', filename='yearly_overview.js') }}"></script>
<script src="{{ url_for('static', filename='prognosis_adaptation_function.js') }}"></script>
{% endblock %}

{% block app_content %}

<div class="pt-3 accordion" id="TableAccordeon">
  <table class="table table-hover table-condensed table-bordered" id="table">
    <caption>
      <div class="row">
        <div class="col-sm">
          <h3>{{table_title}}</h3>
        </div>
        <div class="col-sm text-right">
          <span data-toggle="modal" data-target="#AddNewPrognosisModal">
              <a type="button" class="btn btn-sm btn-primary" data-placement="bottom" title="Add" data-toggle="tooltip">
                <span class="fa fa-plus text-light"></span>
              </a>
          </span>
        </div>
      </div>
    <thead>
      <tr>
        <th scope="col">Month</th>
        <th scope="col">Incoming</th>
        <th scope="col">Outgoing</th>
        <th scope="col">Balance</th>
        </th>
      </tr>
    </thead>
    <tbody>
      {% for key, value in data.items() %}
        {% set data_target_name = 'dt-'+key %}
        <tr  
        {% if key != "Totals" %} 
          data-toggle="collapse" data-target="#{{data_target_name}}" class="accordion-toggle"
        {% endif %}>
            <th scope="row">{{ key }}</th>
            <td> {{ value.incoming }} </td>
            <td> {{ value.outgoing }} </td>
            <td> {{ value.balance }} </td>
        </tr>
        {% if key != "Totals" %} 
        <tr >
            <td colspan="4" class="hiddenRow">
              <div class="accordian-body collapse" id="{{data_target_name}}" data-parent="#TableAccordeon"> 
                {% for prognosis in value.prognoses %}
                  <h5 style="display: inline">
                    <span data-toggle="modal" data-target="#EditPrognosisModal">
                      <a data-toggle="tooltip" onclick='obtain_prognosis_info("{{ prognosis | safe}}");'
                        {% if prognosis.tag.startswith("monthly") %} 
                          class="badge badge-primary"
                        {% elif prognosis.tag.startswith("yearly") %} 
                          class="badge badge-success"
                        {% elif prognosis.tag.startswith("once") %} 
                          class="badge badge-danger"
                        {% elif prognosis.tag.startswith("daily") %} 
                          class="badge badge-warning"
                        {% else %}
                          class="badge badge-info"
                        {% endif %}>
                          {{ prognosis.tag }}
                      </a>
                    </span>
                  </h5>
                 {% endfor %}
              </div>
            </td> 
          </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <!-- Add new Tranaction Modal -->
  <div class="modal fade" id="AddNewPrognosisModal" tabindex="-1" role="dialog"
    aria-labelledby="AddNewPrognosisModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="AddNewPrognosisModalTitle">Add new Prognosis</h3>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form class="form form-basic" method="post" role="form" id="add_new_form">
            {{ forms["add_prognosis"].hidden_tag() }}
            {{ wtf.form_field(forms["add_prognosis"].date, id="add_new_form_date")}}
            {{ wtf.form_field(forms["add_prognosis"].amount, id="add_new_form_amount") }}
            {{ wtf.form_field(forms["add_prognosis"].comment, id="add_new_form_comment") }}
            {{ wtf.form_field(forms["add_prognosis"].occurance_type, id="add_new_form_occurance_type") }}
            {{ wtf.form_field(forms["add_prognosis"].incoming, id="add_new_form_incoming") }}
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" form="add_new_form" class="btn btn-primary">Add Prognosis</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Tranaction Modal -->
  <div class="modal fade" id="EditPrognosisModal" tabindex="-1" role="dialog"
    aria-labelledby="EditPrognosisModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="EditPrognosisModalTitle">Edit Prognosis</h3>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form class="form form-basic" method="post" role="form" id="edit_form">
            {{ forms["edit_prognosis"].hidden_tag() }}
            {{ wtf.form_field(forms["edit_prognosis"].date, id="edit_form_date")}}
            {{ wtf.form_field(forms["edit_prognosis"].amount, id="edit_form_amount") }}
            {{ wtf.form_field(forms["edit_prognosis"].comment, id="edit_form_comment") }}
            {{ wtf.form_field(forms["edit_prognosis"].occurance_type, id="edit_form_occurance") }}
            {{ wtf.form_field(forms["edit_prognosis"].incoming, id="edit_form_incoming") }}
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" form="edit_form" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}